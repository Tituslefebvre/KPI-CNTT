{% extends "base.html" %}

{% block title %}Trang chủ - Hệ thống KPI{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="mb-4">
            <i class="bi bi-house-door-fill"></i> Dashboard
        </h1>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-4">
        <div class="card text-white bg-primary mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-people-fill"></i> Tổng số Viên chức</h5>
                <p class="card-text display-4">{{ total_staff }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-bar-chart-fill"></i> Danh mục KPI</h5>
                <p class="card-text display-4">{{ total_categories }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card text-white bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-calendar-check-fill"></i> Kỳ đánh giá đang mở</h5>
                <p class="card-text display-4">{{ active_periods }}</p>
            </div>
        </div>
    </div>
</div>

{% if current_user.staff_profile %}
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0"><i class="bi bi-clipboard-data"></i> Đánh giá gần đây của bạn</h5>
            </div>
            <div class="card-body">
                {% if recent_evaluations %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Kỳ đánh giá</th>
                                <th>Tổng điểm</th>
                                <th>Trạng thái</th>
                                <th>Ngày tạo</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for eval in recent_evaluations %}
                            <tr>
                                <td>{{ eval.period.name }}</td>
                                <td><strong>{{ "%.2f"|format(eval.total_score) }}</strong></td>
                                <td>
                                    {% if eval.status == 'draft' %}
                                    <span class="badge bg-secondary">Nháp</span>
                                    {% elif eval.status == 'submitted' %}
                                    <span class="badge bg-primary">Đã nộp</span>
                                    {% elif eval.status == 'approved' %}
                                    <span class="badge bg-success">Đã phê duyệt</span>
                                    {% endif %}
                                </td>
                                <td>{{ eval.created_at.strftime('%d/%m/%Y') }}</td>
                                <td>
                                    <a href="{{ url_for('evaluation.detail', id=eval.id) }}" class="btn btn-sm btn-info">
                                        <i class="bi bi-eye"></i> Xem
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted">Chưa có đánh giá nào.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-info-circle"></i> Hướng dẫn sử dụng</h5>
                <ul>
                    <li>Xem và quản lý thông tin viên chức tại menu <strong>Viên chức</strong></li>
                    <li>Quản lý các danh mục và chỉ số KPI tại menu <strong>KPI</strong></li>
                    <li>Tạo và quản lý đánh giá tại menu <strong>Đánh giá</strong></li>
                    <li>Viên chức có thể tự đánh giá và quản lý xem đánh giá của mình</li>
                    <li>Quản lý có quyền tạo, phê duyệt và xem tất cả đánh giá</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
